<!DOCTYPE html>
<html lang="en">
<head>

	<!-- start: Meta -->
	<meta charset="utf-8">
	<title>Stanalyzer</title> 
	<meta name="description" content="All favourite vegan recipes in one place"/>
	<meta name="keywords" content="Stanovi, Nekretnine" />
	<meta name="author" content="Nikola Maric"/>
	<!-- end: Meta -->
	<!-- start: Mobile Specific -->
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<!-- end: Mobile Specific -->
	<!-- start: Facebook Open Graph -->
	<meta property="og:title" content=""/>
	<meta property="og:description" content=""/>
	<meta property="og:type" content=""/>
	<meta property="og:url" content=""/>
	<meta property="og:image" content=""/>
	<!-- end: Facebook Open Graph -->
    <!-- start: CSS -->
    <link href="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" rel="stylesheet">
	<link href="static/css/style.css" rel="stylesheet">
	<link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Droid+Sans:400,700">
	<link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Droid+Serif">
	<link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Boogaloo">
	<link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Economica:700,400italic">
	 <link rel="stylesheet" type="text/css" href="static/css/jquery.jqplot.css" />
	<!-- end: CSS -->
    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

</head>
<body>
<div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container-fluid">
			<div class="navbar-header">
				<button type="button" data-target="#navbarCollapse"
					data-toggle="collapse" class="navbar-toggle">
					<span class="sr-only">Toggle navigation</span> <span
						class="icon-bar"></span> <span class="icon-bar"></span> <span
						class="icon-bar"></span>
				</button>
				<a id="navbar-brand" href="index.html" class="navbar-brand">Stanalyzer</a>
			</div>
        <div class="collapse navbar-collapse">
            <ul class="nav navbar-nav navbar-right">
                <li><a href="logout">Log-out</a></li>
            </ul>
            <ul class="nav navbar-nav">
                <li class="active"><a href="index.html">Appartment list</a></li>
                <li>
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Dashboard<b class="caret"></b></a>
                    <ul class="dropdown-menu multi-level">
                        <li><a href="tmem.html">Thread/Memory Monitor</a></li>
                        <li><a href="querystats.html">Query statistics</a></li>
                        <li><a href="#">Tailer</a></li>
                        <li class="divider"></li>
                        <li><a href="#">System info</a></li>
                    </ul>
                </li>
                <li>
                    <a href="query.html">Analyze dataset</a>
                </li>
            </ul>
        </div><!--/.nav-collapse -->
    </div>
</div>
	
		<!--start: Container -->
    <div class="container-fluid vert-offset-top-6">	
		  	<table id="appartment-table" class="table table-striped table-responsive">
		        <thead>
		            <tr role="row">
		            	<th></th>
		            	<th>ID</th>
		                <th>Lokacija</th>
		                <th>Cena</th>
		                <th>Kvadratura</th>
		                <th>Sajt</th>
		                <th>Link</th>
		                <th>Promena</th>
		            </tr>
		        </thead>
		    </table>
	</div>
	<!-- end: Wrapper  -->			


<!-- start: Java Script -->
<!-- Placed at the end of the document so the pages load faster -->
<script src="http://code.jquery.com/jquery-2.1.1.min.js"></script>
<script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>

<!--[if lt IE 9]><script language="javascript" type="text/javascript" src="static/js/excanvas.min.js"></script><![endif]-->
 <script type="text/javascript" type="text/javascript" src="static/js/jquery.jqplot.min.js"></script>


<script type="text/javascript" src="static/js/jqplot.highlighter.min.js"></script>
<script type="text/javascript" src="static/js/jqplot.cursor.min.js"></script>
<script type="text/javascript" src="static/js/jqplot.dateAxisRenderer.min.js"></script>
<script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.11.0/jquery-ui.min.js"></script>
<script src="static/js/jquery.dataTables.min.js"></script>
<script src="static/js/dataTables.bootstrap.js"></script>
<!-- end: Java Script -->
<script type="text/javascript">
//var plot1 = null;


function createPlot(data,id) {
    	var prices = [[]];
    	
    	for(var i = 0; i < data.length; i++) {
    		
    		prices[0].push([new Date(data[i]["datumOd"]),data[i]["iznos"]])
    		
    		
    		}
//        if (plot1 == null) {
            plot1 = $.jqplot(id, prices, {
                title: "Cene",
                animate: true,
                // Will animate plot on calls to plot1.replot({resetAxes:true})
                animateReplot: true,
                grid: {
                    drawGridLines: false,
                    background: '#2E3338'
                    
                },
                
                series : [{

                        rendererOptions: {
                            // speed up the animation a little bit.
                            // This is a number of milliseconds.
                            // Default for a line series is 2500.
                            animation: {
                                speed: 1500
                            }
                        }

                }],
                axes:{
                    xaxis:{
                      renderer:$.jqplot.DateAxisRenderer,
                      tickOptions:{
                    	  showGridline: false,
                    	  formatString:'%b %#d, %y'
                      },
                      rendererOptions: {
                          daTickInterval: "1 day"
                    	}
                    },
                    yaxis:{
                      tickOptions:{
                    	  	showGridline: false,
                        	formatString:'%.2f â‚¬'
                        }
                    }
                  },
                  highlighter: {
                    show: true,
                    sizeAdjust: 9.5
                  },
                cursor: {
                	show: false
                },
            });
}

$(document).ready(function(){

    //Regenerate the plot on button click.
    $('#chart_left_navigation,#chart_right_navigation').click(function() {
        createPlot("stan");
    });
    
    var table = $('#appartment-table').DataTable( {
        "ajax": "stan",
        "processing": true,
        "serverSide": true,
        "pagingType": "full_numbers",
        "columns": [
                     {
                        "class":          'details-control',
                        "orderable":      false,
                        "data":           null,
                        "defaultContent": ''
                    }, 
            { "data": "DT_RowId" },
            { "data": "lokacija" },
            { "data": "poslednjaCena" },
            { "data": "kvadratura" },
            { "data": "sajt" },
            { "data": "link" },
            { "data": "promenaJedan" },

        ],
        "createdRow": function ( row, data, index ) {
            if ( data["promenaJedan"] > 0) {
                $(row).addClass('danger');
            }
            else if ( data["promenaJedan"] < 0) {
                $(row).addClass('info');
            }
            
            var linkCell = $(row).find("td").eq(6),
            	linkCellValue = linkCell.text();
            linkCell.empty();
            linkCell.append("<a target='_blank' href='"+linkCellValue+"'> Link </a>");
            $(row).find("td").eq(0).append("<span style='cursor:pointer;' class='glyphicon glyphicon-stats'></span>")
        }
    } );
    
 // Add event listener for opening and closing details
    $('#appartment-table tbody').on('click', 'td.details-control', function () {
        var tr = $(this).closest('tr');
        var row = table.row( tr );
 
        if ( row.child.isShown() ) {
            // This row is already open - close it
            $('div.slider', row.child()).slideUp( function () {
                row.child.hide();
                tr.removeClass('shown');
                $(tr).find(".glyphicon").removeClass("glyphicon-chevron-up").addClass("glyphicon-stats")
            } );
        }
        else {
            // Open this row
            var divId = 'plotting_'+$(row).attr("id")+'_div',
            	loaderClass = tr.hasClass("odd") ? "slider-loading-lighter" : "slider-loading-darker"
            row.child( '<div class="slider"><div class="'+loaderClass+'"></div></div>', 'no-padding' ).show();
            tr.addClass('shown');
 			var that = $;
            $('div.slider', row.child()).slideDown("slow", function(){
            	that.get( "stan/"+that(tr).attr('id')+"/cena", displayPlot(divId,tr));
            	that(tr).find(".glyphicon").removeClass("glyphicon-stats").addClass("glyphicon-chevron-up")
            });
        }
    } );
 
    $("#appartment-table thead th").each( function () {
        var title = $('#appartment-table thead th').eq( $(this).index() ).text();
        if(title == 'Lokacija' || title == 'Kvadratura' || title == 'Cena') {
        		$(this).html( '<input type="text" placeholder="Search '+title+'" />' );
        	}
        });
    var table = $('#appartment-table').DataTable();
    
    table.columns().eq( 0 ).each( function ( colIdx ) {
        $( 'input[type="text"]', table.column( colIdx ).footer() ).on( 'keyup', function () {
            table
                .column( colIdx )
                .search( this.value )
                .draw();
        } );
    } );
    
});

function displayPlot (divId,row) {
	return function(data) {
		$(row).next().find("div[class*=slider-loading]").remove();
		$(row).next().find("div.slider").append("<div id='"+divId+"'></div>")
		createPlot(data,divId);
	}
}

/* Formatting function for row details - modify as you need */
function format ( d ) {
    // `d` is the original data object for the row
    return 
//     '<div class="slider">'+
//         '<table cellpadding="5" cellspacing="0" border="0" style="padding-left:50px;">'+
//             '<tr>'+
//                 '<td>Full name:</td>'+
//                 '<td>ssss</td>'+
//             '</tr>'+
//             '<tr>'+
//                 '<td>Extension number:</td>'+
//                 '<td>fvfgvf</td>'+
//             '</tr>'+
//             '<tr>'+
//                 '<td>Extra info:</td>'+
//                 '<td>And any further details here (images etc)...</td>'+
//             '</tr>'+
//         '</table>'+
//     '</div>';
    '<div class="slider"><div class="slider-loading"></div></div>';
}
</script>
</body>
</html>